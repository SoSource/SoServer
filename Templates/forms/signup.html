
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Create User</title>
</head>
  <script type="module">
    import { generateMnemonic } from 'https://cdn.skypack.dev/@scure/bip39';
    import { wordlist } from 'https://cdn.skypack.dev/@scure/bip39/wordlists/english';
    function generatePassword() {
      const strength = 256; // 24-word mnemonic
      const password = generateMnemonic(wordlist, strength);
      console.log("Mnemonic (24 words):", mnemonic);

      var form = document.getElementById("modalForm");
      form.elements["password"].value = password;
    }
    document.addEventListener("DOMContentLoaded", function () {
        const usernameInput = document.getElementById("username");
        const statusSpan = document.getElementById("username-status");
        let timeout = null;

        usernameInput.addEventListener("input", function () {
            clearTimeout(timeout);
            const username = usernameInput.value;

            if (username.length === 0) {
                statusSpan.textContent = "";
                return;
            }

            timeout = setTimeout(() => {
              console.log('check',username)
                fetch(`/accounts/username_avail/?username=${encodeURIComponent(username)}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.available) {
                            statusSpan.textContent = "✓ Available";
                            statusSpan.style.color = "green";
                        } else {
                            statusSpan.textContent = "✗ Taken";
                            statusSpan.style.color = "red";
                        }
                    })
                    .catch(error => {
                        statusSpan.textContent = "Error checking";
                        statusSpan.style.color = "gray";
                    });
            }, 300); // 300ms debounce
        });
    });
  </script>
<body>

<div class='form'>
    <div>

        <form id="modalForm" onsubmit="onFormSubmit();">

          <!-- <form>
            <label for="username">Username:</label>
            <input type="text" id="username" name="username" autocomplete="off">
            <span id="username-status"></span>
          </form> -->


            <span id="field0" style="display: block; height: 25px;"></span>
            <span id="field1">
            <label for="username"> Username:</label>
            <!-- <input type="text" id="username" name="username"> -->
            <input type="text" id="username" name="username" autocomplete="off">
            <span id="username-status">y</span>
            </span><br>
            <span id="field2">
            <label for="password">Passphrase:</label>
            <!-- <span id="passphrase"></span> -->

            <input  type="password" id="password" name="password">
            <span onclick="displayPassword()" id="passwordVisibility" class="material-icons">visibility_off</span>
            </span>
            <!-- <br> -->
            <br>
            <button style='color: black;' onclick="generatePassword()">New Passphrase</button>

            <br>
            <br>
            <br>
            <span id="field3">Passphrase never leaves device.<br>It can be viewed in settings.<br>It cannot be reset if lost.</span>
            <br>
            <span id="field4"></span>
            <br>
            <br>
            <span id="field5">
            <button style='color: black; margin-right: 7px;' type="submit" onclick="modalPopUp('Login', '/accounts/login-signup')">Back</button><button style='color: black;; margin-left: 7px;' type="submit" onclick="loginAuthenticate({{ user_dict }}, '{{ csrf_token }}')">Continue</button>
            </span>
            <!-- <br>
            <br>
            <br>
            <span id="field6">
            <button style='color: black;' type="submit" onclick=generatePassword>Start New</button>
            </span> -->
            </form>
        
            </div>
</div>
<br>
<br>
<br>
{% comment %}
<div>- OR -</div>


<div class='form'>
    <div>
        <div id="authenticateForm" >

            <span>If you have an existing account.</span>
            <br>
            <span>Authenticate with Biometrics.</span>
            <br>
            <br>
            <button style='color: black;' onclick="register({{ user_dict }})">Continue</button>
        </div>
        
    </div>
</div>
{% endcomment %}
<div id="instruction" value="get_stored_user_login_data"></div>

</body>
</html>
